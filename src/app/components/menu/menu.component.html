<nav class="menu-nav" [class.menu-vertical]="vertical" role="navigation">
  
  <!-- Menu header -->
  @if (title) {
    <div class="menu-header">
      <h3 class="menu-title">{{ title }}</h3>
      
      @if (collapsible) {
        <button 
          class="menu-toggle"
          [class.menu-collapsed]="collapsed"
          (click)="toggleCollapse()"
          aria-label="Toggle menu">
          <svg width="16" height="16" viewBox="0 0 24 24">
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" fill="currentColor"/>
          </svg>
        </button>
      }
    </div>
  }
  
  <!-- Menu items -->
  <ul class="menu-list" [class.menu-collapsed]="collapsed" role="menubar">
    @for (item of menuItems; track item.id || $index) {
      <li 
        class="menu-item"
        [class.menu-item-active]="item.active"
        [class.menu-item-disabled]="item.disabled"
        [class.menu-item-has-children]="item.children && item.children.length > 0"
        role="none">
      
      <!-- Main menu link -->
      <a 
        class="menu-link"
        [href]="item.href || '#'"
        [class.menu-link-active]="item.active"
        [attr.aria-current]="item.active ? 'page' : null"
        [attr.tabindex]="item.disabled ? -1 : 0"
        role="menuitem"
        (click)="onItemClick(item, $event)"
        (keydown.enter)="onItemClick(item, $event)"
        (keydown.space)="onItemClick(item, $event); $event.preventDefault()">
        
        <!-- Icon -->
        @if (item.icon) {
          <span class="menu-icon">
            <svg width="18" height="18" viewBox="0 0 24 24">
              <path [attr.d]="getIconPath(item.icon)" fill="currentColor"/>
            </svg>
          </span>
        }
        
        <!-- Label -->
        <span class="menu-label" [class.menu-label-hidden]="collapsed && !item.children">
          {{ item.label }}
        </span>
        
        <!-- Badge -->
        @if (item.badge) {
          <span 
            class="menu-badge" 
            [class]="'menu-badge-' + (item.badgeType || 'default')">
            {{ item.badge }}
          </span>
        }
        
        <!-- Submenu arrow -->
        @if (item.children && item.children.length > 0) {
          <svg 
            class="menu-arrow"
            [class.menu-arrow-expanded]="item.expanded"
            width="16" 
            height="16" 
            viewBox="0 0 24 24">
            <path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z" fill="currentColor"/>
          </svg>
        }
      </a>
      
      <!-- Submenu -->
      @if (item.children && item.children.length > 0) {
        <ul 
          class="menu-submenu"
          [class.menu-submenu-expanded]="item.expanded"
          role="menu">
          @for (child of item.children; track child.id || $index) {
            <li 
              class="menu-subitem"
              [class.menu-subitem-active]="child.active"
              [class.menu-subitem-disabled]="child.disabled"
              role="none">
              
              <a 
                class="menu-sublink"
                [href]="child.href || '#'"
                [class.menu-sublink-active]="child.active"
                [attr.aria-current]="child.active ? 'page' : null"
                [attr.tabindex]="child.disabled ? -1 : 0"
                role="menuitem"
                (click)="onItemClick(child, $event)">
                
                @if (child.icon) {
                  <span class="menu-subicon">
                    <svg width="16" height="16" viewBox="0 0 24 24">
                      <path [attr.d]="getIconPath(child.icon)" fill="currentColor"/>
                    </svg>
                  </span>
                }
                
                <span class="menu-sublabel">{{ child.label }}</span>
                
                @if (child.badge) {
                  <span 
                    class="menu-subbadge" 
                    [class]="'menu-subbadge-' + (child.badgeType || 'default')">
                    {{ child.badge }}
                  </span>
                }
              </a>
            </li>
          }
        </ul>
      }
    </li>
    }
  </ul>
  
  <!-- Menu footer -->
  @if (showFooter) {
    <div class="menu-footer">
      <ng-content select="[slot=footer]"></ng-content>
    </div>
  }
</nav>